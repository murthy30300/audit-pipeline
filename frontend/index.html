<!DOCTYPE html>
<html>
<head>

<title>NBFC Dashboard</title>

<style>

body{

background:#0a0a0a;
color:white;
font-family:monospace;
padding:30px;

}

button{

padding:8px;
margin:10px 0;
cursor:pointer;

}

table{

width:100%;
border-collapse:collapse;

}

td,th{

border:1px solid #333;
padding:8px;

}

.card{

border:1px solid #333;
padding:15px;
margin-bottom:20px;

}

</style>

</head>

<body>

<h2>NBFC Dashboard</h2>

<select onchange="switchView(this.value)">

<option value="lender">Lender</option>

<option value="agent">Agent</option>

<option value="manager">Manager</option>

<option value="hr">HR</option>

</select>


<div id="content"></div>



<script>

const API="http://localhost:8000/dashboard"

function switchView(v){

if(v==="lender") fetchLender()

if(v==="agent") fetchAgent()

if(v==="manager") fetchManager()

if(v==="hr") fetchHR()

}



async function api(url){

const r=await fetch(url)

if(!r.ok) throw new Error("API Error")

return r.json()

}



function kpi(label,value){

return `<div class=card>

<b>${label}</b><br>

${value}

</div>`

}



async function fetchLender(){

const d=await api(

`${API}/lender/portfolio-summary?lender_id=unknown`

)


let buckets=""

for(let k in d.bucket_breakdown){

buckets+=`<tr>

<td>${k}</td>

<td>${d.bucket_breakdown[k]}</td>

</tr>`

}



document.getElementById("content").innerHTML=`

<h3>Lender</h3>


${kpi("Total Disbursed",d.total_disbursed)}

${kpi("NPA Ratio",d.npa_ratio)}

${kpi("Collection Efficiency",d.collection_efficiency)}



<table>

<tr>

<th>Bucket</th>

<th>Amount</th>

</tr>

${buckets}

</table>

`

}





async function fetchAgent(){

const d=await api(

`${API}/agent/assigned-loans?agent_id=AGT_501`

)



let rows=""



for(let l of d.loans){

rows+=`

<tr>

<td>${l.loan_id}</td>

<td>${l.borrower_name}</td>

<td>${l.dpd_days}</td>

<td>${l.overdue_amount}</td>

<td>${l.loan_aging_bucket}</td>

<td>${l.last_call_status}</td>

</tr>

`

}



document.getElementById("content").innerHTML=`

<h3>Agent Assigned Loans</h3>


${kpi("Total Loans",d.total)}

${kpi("Followups Due",d.followups_due)}



<table>

<tr>

<th>Loan</th>

<th>Borrower</th>

<th>DPD</th>

<th>Overdue</th>

<th>Bucket</th>

<th>Status</th>

</tr>

${rows}

</table>

`

}




async function fetchManager(){

const d=await api(

`${API}/manager/branch-summary?branch_id=unknown`

)



let agents=""


for(let a of d.top_agents){

agents+=`

<tr>

<td>${a.agent_id}</td>

<td>${a.calls_made}</td>

<td>${a.calls_successful}</td>

<td>${a.avg_duration_sec}</td>

</tr>

`

}



document.getElementById("content").innerHTML=`

<h3>Manager Summary</h3>



${kpi("Agents Active",d.agents_active_today)}

${kpi("Calls Made",d.calls_made)}

${kpi("Successful",d.calls_successful)}

${kpi("Collection Today",d.collection_today)}

${kpi("Followups",d.followups_pending)}



<table>

<tr>

<th>Agent</th>

<th>Calls</th>

<th>Successful</th>

<th>Avg Duration</th>

</tr>

${agents}

</table>

`

}




async function fetchHR(){

const d=await api(

`${API}/hr/performance`

)



let agents=""



for(let a of d.agents){

agents+=`

<tr>

<td>${a.agent_id}</td>

<td>${a.report_date}</td>

<td>${a.total_calls}</td>

<td>${a.success_rate}</td>

<td>${a.amount_collected}</td>

</tr>

`

}



document.getElementById("content").innerHTML=`

<h3>HR Performance</h3>



${kpi("Total Agents",d.total_agents)}

${kpi("Total Calls",d.total_calls)}

${kpi("Avg Success",d.avg_success_rate)}

${kpi("Collections",d.total_collections)}



<table>

<tr>

<th>Agent</th>

<th>Date</th>

<th>Calls</th>

<th>Success %</th>

<th>Collection</th>

</tr>

${agents}

</table>

`

}



fetchLender()

</script>

</body>

</html>